[
			"Name",
			"Creation-Time",
			"Last-Modified",
			"Etag",
			"Content-Length",
			"Content-Type",
			"Content-Encoding",
			"Content-Language",
			"Content-CRC64",
			"Content-MD5",
			"Cache-Control",
			"Content-Disposition",
			"BlobType",
			"AccessTier",
			"AccessTierChangeTime",
			"AccessTierInferred",
			"Expiry-Time",
			"hdi_isfolder",
			"Owner",
			"Group",
			"Permissions",
			"Acl",
			"Snapshot",
			"Metadata",
			"LastAccessTime",
			"LeaseStatus",
			"LeaseState",
			"LeaseDuration",
			"ServerEncrypted",
			"CustomerProvidedKeySha256",
			"RehydratePriority",
			"ArchiveStatus",
			"EncryptionScope",
			"CopyId",
			"CopyStatus",
			"CopySource",
			"CopyProgress",
			"CopyCompletionTime",
			"CopyStatusDescription",
			"ImmutabilityPolicyUntilDate",
			"ImmutabilityPolicyMode",
			"LegalHold",
			"DeletionId",
			"Deleted",
			"DeletedTime",
			"RemainingRetentionDays"
		]

-- Requête de détection d'opportunités d'optimisation de stockage
SELECT 
    [Name],
    [Content-Length],
    [AccessTier],
    [Creation-Time],
    [Last-Modified],
    [LastAccessTime],
    CASE 
        -- Si le blob est en tiers Hot ou Cool et n'a pas été accédé depuis plus de 6 mois,
        -- il pourrait être éligible pour un déplacement vers le tiers Archive
        WHEN [AccessTier] IN ('Hot','Cool') AND [LastAccessTime] < DATEADD(month, -6, GETDATE())
             THEN 'Migrer vers Archive'
             
        -- Si le blob est très volumineux (par exemple > 100MB) et n'a pas été accédé depuis plus de 3 mois,
        -- il est recommandé de revoir la politique de stockage (migration ou suppression)
        WHEN [Content-Length] > 104857600 AND [LastAccessTime] < DATEADD(month, -3, GETDATE())
             THEN 'Revoir la politique de stockage'
             
        ELSE 'Aucune action requise'
    END AS OpportuniteOptimization
FROM AzureBlobInventory
WHERE 
    [Deleted] = 0;  -- Considérer uniquement les blobs non supprimés

